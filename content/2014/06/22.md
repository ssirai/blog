Title: pelican でブログを作る
Date: 2014-06-22 21:00
Category: Python
Slug: my-blog-post-using-pelican
Author: ssirai

pelican でブログ作っているので手短にやったことを書く。このポスト自体が pelican のテストなのであまりちゃんと解説書く気ないですスイマセン。

## インストール

まず github でリポジトリを作り `gh-pages` ブランチを作る。

```bash
$ git clone https://github.com/{username}/blog.git
$ cd blog
```

python 3.x のサポートが微妙なので（Fabric がインストールできない） 2.7 に切り替える。

```bash
$ pyenv local 2.7.6
```

必要なものをインストール。

```bash
$ pip install pelican
$ pip install Fabric
$ pip install Markdown
$ pip install ghp-import
```
`pelican-quickstart` して適当に質問に答えると色々ファイルが生成される。

## 日記を書く

`content` 以下に Markdown 形式で日記を書く。書式は以下からコピペして書き換える。

> [Getting started — Pelican 3.3.0 documentation](http://docs.getpelican.com/en/3.3.0/getting_started.html#kickstart-your-site)

```
Title: My super title
Date: 2010-12-03 10:20
Category: Python
Tags: pelican, publishing
Slug: my-super-post
Author: Alexis Metaireau
Summary: Short version for index and feeds

This is the content of my super blog post.
```

早速ビルドしてみる。

```bash
$ fab build
$ fab reserve
```

ブラウザから `localhost:8000` を開く。

Slug から URL が生成されるらしい。Slug を削ると Title を元に URL を生成するらしいのだが、これが日本語を中国語の翻訳機にかけたような謎の URL になる。

> pelican で作るブログ
>
> http://localhost:8000/pelican-dezuo-ruburogu.html

pelican dezuo ruburogu とは一体…

ブログなら URL は `{year}/{month}/{date}/{slug}.html` という構成にしたいですね。

> [Settings — Pelican 3.3.1.dev documentation](http://docs.getpelican.com/en/latest/settings.html)

上の URL settings を見ればいいのだがちょっと把握しづらい。

とりあえず `pelicanconf.py` に以下を追加したらなんとなくいい感じになった。

```python
ARTICLE_URL     = 'posts/{date:%Y}/{date:%m}/{date:%d}/{slug}/'
ARTICLE_SAVE_AS = 'posts/{date:%Y}/{date:%m}/{date:%d}/{slug}/index.html'
```

## liquid tag による IPython Notebook の挿入

まず数式が使えないので `pelican-plugins` から `latex` パッケージを入れておく。これは `mathjax` の別名。

```bash
$ git clone https://github.com/getpelican/pelican-plugins
```

conf ファイルに以下を記述する（pelican から実行できれば名前は何でもいいっぽい？ `pelican-quickstart` から作った場合デフォルトは `pelicanconf.py` と `publishconf.py` のどちらか）。

```python
PLUGIN_PATH = '/path/to/pelican-plugins'
PLUGINS = ['liquid_tags.notebook', 'latex']
```

`/path/to/` は絶対パスで。`~` をなんとなしに使ったらダメだった。そりゃそうか。

数式はこれだけの設定でよい。`liquid_tags.notebook` というプラグインで IPython Notebook を記事の好きな場所に挟み込むことができるようになる。

```
{% notebook filename.ipynb %}
```

注意点は notebook を置く場所である。デフォルトでは `content/` 以下に `notebooks/` というフォルダを作ってそこに `filename.ipynb` を置く必要がある。そういう規約である。`NOTEBOOK_DIR` を変えればデフォルトの設定は変更できるが特に不満はないしそのままにしておく。

最後のステップとして `_nb_header.html` の設定をする必要がある。`_nb_header.html` は `liquid_tags.notebook` を使っているとpelican プロジェクトのルートフォルダに自動で生成される。これを挿入すると notebook の表示が奇麗になる。

まず `theme` の `template` に次のような文を書く。

```
{% if EXTRA_HEADER %}
{{ EXTRA_HEADER }}
{% endif %}
```

が、自分は `pelipress` テーマを使っておりそこには既に書かれていたので必要なかった。

conf に `_nb_header.html` を読みこむ設定を書く。

```python
EXTRA_HEADER = open('_nb_header.html').read().decode('utf-8')
```

これにて準備は完成！

以前作ったノートを挟んでおく。

`IJulia` なのだが構文がカラーリングされておりませんな。

{% notebook random_search.ipynb %}


